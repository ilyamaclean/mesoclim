<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="mesoclim">
<title>ADDTREES Workflow without bias correction â€¢ mesoclim</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ADDTREES Workflow without bias correction">
<meta property="og:description" content="mesoclim">
<meta property="og:image" content="https://jrmosedale.github.io/mesoclim/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mesoclim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/mesoclim_1_download.html">1 Downloading Inputs</a>
    <a class="dropdown-item" href="../articles/mesoclim_2_preparedata.html">2. Data pre-processing</a>
    <a class="dropdown-item" href="../articles/mesoclim_3_spdscale.html">3. Spatial downscaling</a>
    <a class="dropdown-item" href="../articles/mesoclim_4_tmpdscale.html">4. Temporal downscaling</a>
    <a class="dropdown-item" href="../articles/mesoclim_5_biascorrect.html">5. Bias correction</a>
    <a class="dropdown-item" href="../articles/mesoclim_addtrees.html">ADDTREES Workflow without bias correction</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>ADDTREES Workflow without bias correction</h1>
            
      
      <small class="dont-index">Source: <a href="NA/NA/NA/blob/HEAD/vignettes/articles/mesoclim_addtrees.Rmd"><code>vignettes/articles/mesoclim_addtrees.Rmd</code></a></small>
      <div class="d-none name"><code>mesoclim_addtrees.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'lubridate'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     date, intersect, setdiff, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.7.71</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ilyamaclean/mesoclim" class="external-link">mesoclim</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'lubridate::union' by 'raster::union' when</span></span>
<span><span class="co">#&gt; loading 'mesoclim'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'lubridate::intersect' by</span></span>
<span><span class="co">#&gt; 'raster::intersect' when loading 'mesoclim'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'magrittr::extract' by 'raster::extract'</span></span>
<span><span class="co">#&gt; when loading 'mesoclim'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'lubridate::origin' by 'raster::origin' when</span></span>
<span><span class="co">#&gt; loading 'mesoclim'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'fields::describe' by 'terra::describe' when</span></span>
<span><span class="co">#&gt; loading 'mesoclim'</span></span>
<span><span class="co">#&gt; Warning: replacing previous import 'magrittr::inset' by 'terra::inset' when</span></span>
<span><span class="co">#&gt; loading 'mesoclim'</span></span>
<span></span>
<span><span class="co"># time whole process</span></span>
<span><span class="va">tbegin</span><span class="op">&lt;-</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html" class="external-link">now</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="setup-inputs">Setup &amp; Inputs<a class="anchor" aria-label="anchor" href="#setup-inputs"></a>
</h2>
<p>Downscaling requires the following files &amp; directories:</p>
<ul>
<li><p>Filepath to vector file of parcels output by ellicitor
app.</p></li>
<li><p>Filepath to coastline boundary polygon (not necessary if dtm
already masked)</p></li>
<li><p>Filepath to 50m DTM of UK (OS Terrain50 - which has advantages in
having a .vrt raster that can be queried to enhance cropping and
extraction of relevant area to match aoi etc. Subdirectories within hold
actual tiled data.)</p></li>
<li><p>Directory holding UKCP18 RCM climate data files - holding raw .nc
files (by variable and decade) as downloaded from ceda for the defined
time period.</p></li>
<li><p>Directory holding UKCP18 derived sea surface temperature data
files - holding .nc files as downloaded from ceda</p></li>
<li><p>Directory for outputs - to which individual parcel .csv
timeseries files are written.</p></li>
</ul>
<p>Additional parameters required:</p>
<ul>
<li><p>Start time for climate timeseries.</p></li>
<li><p>End time for climate timeseries.</p></li>
<li><p>Model runs of UKCP18rcm to be downscaled</p></li>
</ul>
<p>For this article, <em>I am assuming you are using the shared folder
of mesoclim inputs</em>. You should only have to change
<code>dir_root</code> to the directory in which the shared folder is
located for the rest of the setup to workâ€¦</p>
<p>For a quicker run time, reduce the time period as defined by
<code>ftr_sdate</code> and <code>ftr_edate</code> parameters. Other
parameters are chosen to work with the shared data folder.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CHANGE this...</span></span>
<span><span class="va">dir_root</span><span class="op">&lt;-</span><span class="st">'D:'</span></span>
<span></span>
<span><span class="co"># ... and these should be OK</span></span>
<span><span class="va">parcels_file</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_root</span>,<span class="st">'mesoclim_inputs'</span>,<span class="st">'parcels'</span>,<span class="st">'land_parcels.shp'</span><span class="op">)</span> <span class="co"># elicitor app output file</span></span>
<span><span class="va">coast_file</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_root</span>,<span class="st">'mesoclim_inputs'</span>,<span class="st">'boundaries'</span>,<span class="st">'CTRY_DEC_2023_UK_BGC.shp'</span><span class="op">)</span> <span class="co"># MHW line generalised to 20m</span></span>
<span><span class="va">ukdtm_file</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_root</span>,<span class="st">'mesoclim_inputs'</span>,<span class="st">'dtm'</span>,<span class="st">"GBdem50.vrt"</span><span class="op">)</span> <span class="co"># 50m dtm virtual raster</span></span>
<span></span>
<span><span class="va">dir_ukcp</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_root</span>,<span class="st">'mesoclim_inputs/ukcp18rcm'</span><span class="op">)</span> <span class="co"># holds ukcp rcm climate and elevation data</span></span>
<span><span class="va">dir_sst</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_root</span>,<span class="st">'mesoclim_inputs/ukcp18sst'</span><span class="op">)</span> <span class="co"># ukcp18 derived data of sea surface temperature</span></span>
<span><span class="va">dir_out</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_root</span>,<span class="st">'mesoclim_inputs/outputs'</span><span class="op">)</span>  <span class="co"># output dir</span></span>
<span></span>
<span><span class="co"># Parameters chosen to work with this data</span></span>
<span><span class="va">ftr_sdate</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXlt</a></span><span class="op">(</span><span class="st">'2020/01/01'</span><span class="op">)</span></span>
<span><span class="va">ftr_edate</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXlt</a></span><span class="op">(</span><span class="st">'2020/12/31'</span><span class="op">)</span> <span class="co"># If using shared data folder use max value of as.POSIXlt('2039/12/31')</span></span>
<span></span>
<span><span class="va">modelrun</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'06'</span><span class="op">)</span> </span>
<span><span class="va">collection</span><span class="op">&lt;-</span><span class="st">'land-rcm'</span></span>
<span><span class="va">domain</span><span class="op">&lt;-</span><span class="st">'uk'</span></span>
<span><span class="va">rcp</span><span class="op">&lt;-</span><span class="st">'rcp85'</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="download-data">Download data<a class="anchor" aria-label="anchor" href="#download-data"></a>
</h2>
<blockquote>
<p><strong>NOT required if working with the shared input data
folder.</strong></p>
</blockquote>
<p>The functions will download from ceda archive the UKCP18 RCM data
required, as defined by previously defined parameters.</p>
<p><strong>Download UKCP18 regional climate data: </strong></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># UKCP18 RCM data </span></span>
<span><span class="va">report</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/download_ukcp18.html">download_ukcp18</a></span><span class="op">(</span></span>
<span>    <span class="va">dir_ukcp</span>,</span>
<span>    <span class="va">ftr_sdate</span>,<span class="va">ftr_edate</span>,</span>
<span>    <span class="va">collection</span>, <span class="va">domain</span>, <span class="va">rcp</span>, member<span class="op">=</span><span class="va">modelrun</span>,</span>
<span>    vars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'clt'</span>,<span class="st">'hurs'</span>,<span class="st">'pr'</span>,<span class="st">'prsn'</span>,<span class="st">'psl'</span>,<span class="st">'rls'</span>,<span class="st">'rss'</span>,<span class="st">'tasmax'</span>,<span class="st">'tasmin'</span>,<span class="st">'uas'</span>,<span class="st">'vas'</span><span class="op">)</span>,</span>
<span>    download_dtm<span class="op">=</span><span class="cn">TRUE</span>, <span class="co"># will also download elevation data used in ukcp18 rcm model runs</span></span>
<span>    cedausr<span class="op">=</span><span class="va">cedausr</span>, cedapwd<span class="op">=</span><span class="va">cedapwd</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">report</span><span class="op">)</span></span></code></pre></div>
<p><strong>Download UKCP18 driven sea surface temperature
data:</strong></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sst data</span></span>
<span><span class="va">report</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/download_ukcpsst.html">download_ukcpsst</a></span><span class="op">(</span><span class="va">dir_sst</span>,<span class="va">ftr_sdate</span>,<span class="va">ftr_edate</span>,<span class="va">modelrun</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-data">Prepare data<a class="anchor" aria-label="anchor" href="#prepare-data"></a>
</h2>
<div class="section level3">
<h3 id="prepare-downscaling-area-and-elevation-data">Prepare downscaling area and elevation data<a class="anchor" aria-label="anchor" href="#prepare-downscaling-area-and-elevation-data"></a>
</h3>
<p>Area of interest (aoi) for which downscaling will occur defined by
bounding box around parcel data. This is then used to crop elevation
data to generate dtms required for downscaling.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load dtm, boundary(coast) </span></span>
<span><span class="va">dtm</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">ukdtm_file</span><span class="op">)</span> <span class="co"># 50m resolution dtm of all UK </span></span>
<span><span class="va">coast_v</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/project.html" class="external-link">project</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">coast_file</span><span class="op">)</span>,<span class="va">dtm</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># Load parcels file and projectto crs of output dtmm (OS coords)</span></span>
<span><span class="va">parcels_v</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/project.html" class="external-link">project</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">parcels_file</span><span class="op">)</span>,<span class="va">dtm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate local and wider extents (for aoi and coatal/wind effects) </span></span>
<span><span class="va">aoi</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/project.html" class="external-link">project</a></span><span class="op">(</span><span class="va">parcels_v</span>,<span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">dtm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">aoi</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">dtm</span><span class="op">)</span></span>
<span><span class="va">buffer_metres</span><span class="op">&lt;-</span><span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html" class="external-link">set_units</a></span><span class="op">(</span><span class="fl">15000</span>,<span class="st">'m'</span><span class="op">)</span></span>
<span><span class="va">aoi_buf</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/buffer.html" class="external-link">buffer</a></span><span class="op">(</span><span class="va">aoi</span>,<span class="va">buffer_metres</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create local dtms  - ensure they fall within extent of loaded dtm &amp; mask to coast_v (sets sea to NA)</span></span>
<span><span class="va">dtmf</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">dtm</span>,<span class="va">aoi</span><span class="op">)</span>,<span class="va">dtm</span><span class="op">)</span>,<span class="va">coast_v</span><span class="op">)</span></span>
<span><span class="va">dtmm</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">dtm</span>,<span class="va">aoi_buf</span><span class="op">)</span>,<span class="va">dtm</span><span class="op">)</span>,<span class="va">coast_v</span><span class="op">)</span></span>
<span><span class="va">dtmm</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">dtmm</span>,<span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show local aoi within wider dtm</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dtmm</span>,main<span class="op">=</span><span class="st">'AOI area within wider dtmm'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">aoi</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="mesoclim_addtrees_files/figure-html/dtm_preprocess-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Coarse dtm matching ukcp18 inputs - crop to dtmm extent</span></span>
<span><span class="va">dtmc</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">dir_ukcp</span>,<span class="st">"orog_land-rcm_uk_12km_osgb.nc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dtmc</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">dtmc</span>,<span class="va">dtmm</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Plot dtmf and overlay parcels</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dtmf</span>,main<span class="op">=</span><span class="st">'Parcels'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">parcels_v</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="mesoclim_addtrees_files/figure-html/dtm_preprocess-2.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="prepare-climate-data">Prepare climate data<a class="anchor" aria-label="anchor" href="#prepare-climate-data"></a>
</h3>
<p>Future climate input files cropped and processed to a standard list
of variables for the area of interest AND for each model run.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Future</span></span>
<span><span class="va">t0</span><span class="op">&lt;-</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html" class="external-link">now</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ftr_ukcpdata</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/ukcp18toclimarray.html">ukcp18toclimarray</a></span><span class="op">(</span><span class="va">dir_ukcp</span>, <span class="va">dtmc</span>, <span class="va">ftr_sdate</span>, <span class="va">ftr_edate</span>,</span>
<span>                             <span class="va">collection</span>, <span class="va">domain</span>, <span class="va">modelrun</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading clt_rcp85_land-rcm_uk_12km_06_day_20101201-20201130.nc</span></span>
<span><span class="co">#&gt; Loading clt_rcp85_land-rcm_uk_12km_06_day_20201201-20301130.nc</span></span>
<span><span class="co">#&gt; Loading hurs_rcp85_land-rcm_uk_12km_06_day_20101201-20201130.nc</span></span>
<span><span class="co">#&gt; Loading hurs_rcp85_land-rcm_uk_12km_06_day_20201201-20301130.nc</span></span>
<span><span class="co">#&gt; Loading pr_rcp85_land-rcm_uk_12km_06_day_20101201-20201130.nc</span></span>
<span><span class="co">#&gt; Loading pr_rcp85_land-rcm_uk_12km_06_day_20201201-20301130.nc</span></span>
<span><span class="co">#&gt; Loading psl_rcp85_land-rcm_uk_12km_06_day_20101201-20201130.nc</span></span>
<span><span class="co">#&gt; Loading psl_rcp85_land-rcm_uk_12km_06_day_20201201-20301130.nc</span></span>
<span><span class="co">#&gt; Loading rls_rcp85_land-rcm_uk_12km_06_day_20101201-20201130.nc</span></span>
<span><span class="co">#&gt; Loading rls_rcp85_land-rcm_uk_12km_06_day_20201201-20301130.nc</span></span>
<span><span class="co">#&gt; Loading rss_rcp85_land-rcm_uk_12km_06_day_20101201-20201130.nc</span></span>
<span><span class="co">#&gt; Loading rss_rcp85_land-rcm_uk_12km_06_day_20201201-20301130.nc</span></span>
<span><span class="co">#&gt; Loading tasmax_rcp85_land-rcm_uk_12km_06_day_20101201-20201130.nc</span></span>
<span><span class="co">#&gt; Loading tasmax_rcp85_land-rcm_uk_12km_06_day_20201201-20301130.nc</span></span>
<span><span class="co">#&gt; Loading tasmin_rcp85_land-rcm_uk_12km_06_day_20101201-20201130.nc</span></span>
<span><span class="co">#&gt; Loading tasmin_rcp85_land-rcm_uk_12km_06_day_20201201-20301130.nc</span></span>
<span><span class="co">#&gt; Loading uas_rcp85_land-rcm_uk_12km_06_day_20101201-20201130.nc</span></span>
<span><span class="co">#&gt; Loading uas_rcp85_land-rcm_uk_12km_06_day_20201201-20301130.nc</span></span>
<span><span class="co">#&gt; Loading vas_rcp85_land-rcm_uk_12km_06_day_20101201-20201130.nc</span></span>
<span><span class="co">#&gt; Loading vas_rcp85_land-rcm_uk_12km_06_day_20201201-20301130.nc</span></span>
<span><span class="co">#&gt; Using constant land and sea albedo values - assuming NA values in dtmc are sea!!</span></span>
<span><span class="va">prep_time</span><span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html" class="external-link">now</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="va">t0</span></span>
<span><span class="co"># write_climdata(ftr_ukcpdata,file.path(dir_out,'ftr_ukcpdata.Rds'))</span></span></code></pre></div>
<p>Time for climate data preparation = 51.04 minutes.</p>
</div>
<div class="section level3">
<h3 id="prepare-sea-surface-data">Prepare Sea surface data<a class="anchor" aria-label="anchor" href="#prepare-sea-surface-data"></a>
</h3>
<p>Sea surface temperatures are also loaded and cropped to dtmm
extent.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Sea surface temperature </span></span>
<span><span class="va">sst</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/create_ukcpsst_data.html">create_ukcpsst_data</a></span><span class="op">(</span><span class="va">dir_sst</span>,<span class="va">ftr_sdate</span>,<span class="va">ftr_edate</span>,<span class="va">dtmm</span>,<span class="va">modelrun</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="checking-data-inputs">Checking data inputs<a class="anchor" aria-label="anchor" href="#checking-data-inputs"></a>
</h3>
<p>The resulting data structures of pre-processing can be checked to
ensure there are no missing or unexpected values that may indicate a
difference in the expected SI units or incomplete input datasets. This
is particularly advisable if the inputs for spatial downscaling are not
derived from one of the provided functions.</p>
<p>The <code>checkinputs</code> function also provides basic statistics
and sample plots of climate variables.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ftr_ukcpdata</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/checkinputs.html">checkinputs</a></span><span class="op">(</span><span class="va">ftr_ukcpdata</span>, tstep <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Weather observations = 366"</span></span>
<span><span class="co">#&gt; [1] "Timesteps= 24 hrs, max= 24 hrs, min= 24 hrs"</span></span>
<span><span class="co">#&gt; [1] "Observations over 1 years, or 11.97 months, or 365 days."</span></span>
<span><span class="co">#&gt;              Min.    Mean    Max.</span></span>
<span><span class="co">#&gt; cloud       0.000  76.304 100.000</span></span>
<span><span class="co">#&gt; relhum     50.332  79.018  99.072</span></span>
<span><span class="co">#&gt; prec        0.000   3.623  49.348</span></span>
<span><span class="co">#&gt; pres       96.706 101.561 104.084</span></span>
<span><span class="co">#&gt; lwrad     210.185 314.024 376.087</span></span>
<span><span class="co">#&gt; swrad       2.822 132.751 348.986</span></span>
<span><span class="co">#&gt; tmax        2.886  14.011  27.069</span></span>
<span><span class="co">#&gt; tmin       -2.980  10.066  19.730</span></span>
<span><span class="co">#&gt; windspeed   0.017   4.921  19.266</span></span>
<span><span class="co">#&gt; winddir     0.510 159.920 358.930</span></span>
<span><span class="co">#&gt; elevation  25.748  42.511  58.514</span></span>
<span><span class="co">#&gt; [1] "Plotting spatial variation by month: red=max, green=mean, blue=min"</span></span></code></pre></div>
<p><img src="mesoclim_addtrees_files/figure-html/check_inputs-1.png" width="700"></p>
<pre><code><span><span class="co">#&gt; [1] "Plotting wind direction figures"</span></span></code></pre>
<p><img src="mesoclim_addtrees_files/figure-html/check_inputs-2.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="downscale-ukcp18-climate-data-to-50m">Downscale ukcp18 climate data to 50m<a class="anchor" aria-label="anchor" href="#downscale-ukcp18-climate-data-to-50m"></a>
</h2>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Future - takes about 20mins using shared folder inputs</span></span>
<span><span class="va">t0</span><span class="op">&lt;-</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html" class="external-link">now</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">ftr_mesoclim</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/spatialdownscale.html">spatialdownscale</a></span><span class="op">(</span><span class="va">ftr_ukcpdata</span>, <span class="va">sst</span>, <span class="va">dtmf</span>, <span class="va">dtmm</span>, </span>
<span>                               basins <span class="op">=</span> <span class="cn">NA</span>, cad <span class="op">=</span> <span class="cn">TRUE</span>, coastal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                               thgto <span class="op">=</span> <span class="fl">2</span>, whgto <span class="op">=</span> <span class="fl">2</span>, rhmin <span class="op">=</span> <span class="fl">20</span>, </span>
<span>                               pksealevel <span class="op">=</span> <span class="cn">TRUE</span>, patchsim <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                              terrainshade <span class="op">=</span> <span class="cn">FALSE</span>, precipmethod <span class="op">=</span> <span class="st">"Elev"</span>, </span>
<span>                              fast <span class="op">=</span> <span class="cn">TRUE</span>, noraincut <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="co">#&gt; Downscaling wind...</span></span>
<span><span class="co">#&gt; Downscaling temperature...</span></span>
<span><span class="co">#&gt; Downscaling relative humidity</span></span>
<span><span class="co">#&gt; Downscaling pressure...</span></span>
<span><span class="co">#&gt; Downscaling SW radiation...</span></span>
<span><span class="co">#&gt; Downscaling LW radiation with terrain shading...</span></span>
<span><span class="co">#&gt; Downscaling precipitation...</span></span>
<span><span class="co">#&gt; Formatting output...</span></span>
<span><span class="va">dscale_time</span><span class="op">&lt;-</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html" class="external-link">now</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="va">t0</span></span></code></pre></div>
<p>Time taken for downscaling function = 1.39 minutes.</p>
<div class="section level4">
<h4 id="display-downscaled-outputs">Display downscaled outputs<a class="anchor" aria-label="anchor" href="#display-downscaled-outputs"></a>
</h4>
<p>Min, max and mean values in tabular form for all times and
locations:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">climvars</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'tmin'</span>,<span class="st">'tmax'</span>,<span class="st">'relhum'</span>,<span class="st">'pres'</span>,<span class="st">'swrad'</span>,<span class="st">'lwrad'</span>,<span class="st">'windspeed'</span>,<span class="st">'winddir'</span>,<span class="st">'prec'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">smry_fun</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.array</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rslt</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ftr_mesoclim</span><span class="op">[</span><span class="va">climvars</span><span class="op">]</span>,<span class="va">smry_fun</span><span class="op">)</span></span>
<span><span class="va">stats_df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">rslt</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Min.'</span>,<span class="st">'Mean'</span>,<span class="st">'Max.'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">stats_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;              Min.    Mean    Max.</span></span>
<span><span class="co">#&gt; tmin       -3.306   9.778  19.186</span></span>
<span><span class="co">#&gt; tmax        3.061  13.988  27.318</span></span>
<span><span class="co">#&gt; relhum     43.596  79.541 100.000</span></span>
<span><span class="co">#&gt; pres       95.704 100.987 104.092</span></span>
<span><span class="co">#&gt; swrad       3.550 130.987 337.042</span></span>
<span><span class="co">#&gt; lwrad     208.372 313.303 374.757</span></span>
<span><span class="co">#&gt; windspeed   0.034   2.680  13.979</span></span>
<span><span class="co">#&gt; winddir     0.033 159.813 359.992</span></span>
<span><span class="co">#&gt; prec        0.000   3.787  44.702</span></span></code></pre></div>
<p>Or as raster plots for days corresponding to spatial quantiles (ie
days where spatial means are data min, median and max values of
timeseries). Example plots of max and min daily temperatures,
precipitation and dirunal temperature range:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span><span class="op">(</span><span class="va">var</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'tmax'</span>,<span class="st">'tmin'</span>,<span class="st">'prec'</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">r</span><span class="op">&lt;-</span><span class="va">ftr_mesoclim</span><span class="op">[[</span><span class="va">var</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">var</span>,<span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/plot_q_layers.html">plot_q_layers</a></span><span class="op">(</span><span class="va">r</span>,vtext<span class="op">=</span><span class="va">var</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="mesoclim_addtrees_files/figure-html/map-outputs-1.png" width="700"><img src="mesoclim_addtrees_files/figure-html/map-outputs-2.png" width="700"><img src="mesoclim_addtrees_files/figure-html/map-outputs-3.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Show spatial range in daily temperatures</span></span>
<span><span class="va">diurnaltmp</span><span class="op">&lt;-</span><span class="va">ftr_mesoclim</span><span class="op">$</span><span class="va">tmax</span><span class="op">-</span><span class="va">ftr_mesoclim</span><span class="op">$</span><span class="va">tmin</span></span>
<span><span class="fu"><a href="../reference/plot_q_layers.html">plot_q_layers</a></span><span class="op">(</span><span class="va">diurnaltmp</span>,vtext<span class="op">=</span><span class="st">'diurnalT'</span><span class="op">)</span></span></code></pre></div>
<p><img src="mesoclim_addtrees_files/figure-html/map-outputs-4.png" width="700"></p>
<p>Or as plots of timeseries of spatial statistics (min, max and mean),
for example by day of year (averaged over all years):</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>,cex.main<span class="op">=</span><span class="fl">0.8</span>, mgp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">0.1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">1</span>,<span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,heights<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="st">"Spatial mean (green), max (red) and min (blue) by day of year"</span>,cex<span class="op">=</span><span class="fl">1</span>,font<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">v</span> <span class="kw">in</span> <span class="va">climvars</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">r</span><span class="op">&lt;-</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/wrap.html" class="external-link">unwrap</a></span><span class="op">(</span><span class="va">ftr_mesoclim</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/plot_timestats_r.html">plot_timestats_r</a></span><span class="op">(</span><span class="va">r</span>,<span class="va">v</span>,idx<span class="op">=</span><span class="st">'doy'</span>,lgd<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="mesoclim_addtrees_files/figure-html/tseries_output-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="calculate-and-write-parcel-outputs">Calculate and write parcel outputs<a class="anchor" aria-label="anchor" href="#calculate-and-write-parcel-outputs"></a>
</h2>
<p>Calculate weighted means of climate variables for each parcel and
write as .csv files.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate parcel values </span></span>
<span><span class="va">t0</span><span class="op">&lt;-</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html" class="external-link">now</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">parcel_list</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/create_parcel_list.html">create_parcel_list</a></span><span class="op">(</span><span class="va">ftr_mesoclim</span>,<span class="va">parcels_v</span>,id<span class="op">=</span><span class="st">'gid'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tmax"</span></span>
<span><span class="co">#&gt; [1] "tmin"</span></span>
<span><span class="co">#&gt; [1] "swrad"</span></span>
<span><span class="co">#&gt; [1] "lwrad"</span></span>
<span><span class="co">#&gt; [1] "relhum"</span></span>
<span><span class="co">#&gt; [1] "pres"</span></span>
<span><span class="co">#&gt; [1] "prec"</span></span>
<span><span class="co">#&gt; [1] "windspeed"</span></span>
<span></span>
<span><span class="co"># Write parcel files</span></span>
<span><span class="fu"><a href="../reference/write_parcels.html">write_parcels</a></span><span class="op">(</span><span class="va">parcel_list</span>, <span class="va">dir_out</span>, overwrite<span class="op">=</span><span class="st">'replace'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">parcel_time</span><span class="op">&lt;-</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html" class="external-link">now</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="va">t0</span></span>
<span><span class="va">total_time</span><span class="op">&lt;-</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/now.html" class="external-link">now</a></span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="va">tbegin</span></span></code></pre></div>
<p>Time for parcel calculation and writing = 4.38 minutes.</p>
<p><em>Total time taken for code execution = 7.02 minutes.</em></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ilya Maclean, Alexandra Gardner, Jonathan Mosedale.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
