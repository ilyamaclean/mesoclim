<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The function era5toclimarray converts data in a netCDF4 file returned
by mcera5::request_era5() to the correct formal required for subsequent modelling."><title>convert era4 ncdf4 file to format required for model — era5toclimarray • mesoclim</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="convert era4 ncdf4 file to format required for model — era5toclimarray"><meta property="og:description" content="The function era5toclimarray converts data in a netCDF4 file returned
by mcera5::request_era5() to the correct formal required for subsequent modelling."><meta property="og:image" content="https://jrmosedale.github.io/mesoclim/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">mesoclim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/mesoclim_1_download.html">1 Downloading Inputs</a>
    <a class="dropdown-item" href="../articles/mesoclim_2_preparedata.html">2. Data pre-processing</a>
    <a class="dropdown-item" href="../articles/mesoclim_3_spdscale.html">3. Spatial downscaling</a>
    <a class="dropdown-item" href="../articles/mesoclim_4_tmpdscale.html">4. Temporal downscaling</a>
    <a class="dropdown-item" href="../articles/mesoclim_5_biascorrect.html">5. Bias correction</a>
    <a class="dropdown-item" href="../articles/mesoclim_addtrees.html">ADDTREES Workflow without bias correction</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>convert era4 ncdf4 file to format required for model</h1>
      <small class="dont-index">Source: <a href="NA/NA/NA/blob/HEAD/R/era5_functions.R"><code>R/era5_functions.R</code></a></small>
      <div class="d-none name"><code>era5toclimarray.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function <code>era5toclimarray</code> converts data in a netCDF4 file returned
by <code><a href="https://rdrr.io/pkg/mcera5/man/request_era5.html" class="external-link">mcera5::request_era5()</a></code> to the correct formal required for subsequent modelling.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">era5toclimarray</span><span class="op">(</span></span>
<span>  <span class="va">ncfile</span>,</span>
<span>  dtm <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  aoi <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  dtr_cor_fac <span class="op">=</span> <span class="fl">1.285</span>,</span>
<span>  toArrays <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>ncfile</dt>
<dd><p>character vector containing the path and filename of the nc file</p></dd>


<dt>dtm</dt>
<dd><p>a SpatRaster object of elevations covering the extent of the study area (see details)</p></dd>


<dt>dtr_cor_fac</dt>
<dd><p>numeric value to be used in the diurnal temperature range
correction of coastal grid cells. Default = 1.285, based on calibration against UK Met Office
observations. If set to zero, no correction is applied.</p></dd>


<dt>toArrays</dt>
<dd><p>logical determining if climate data returned as list of arrays. If FALSE returns list of Spatrasters.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a list of the following:</p><dl><dt>dtm</dt>
<dd><p>Digital elevation of downscaled area in metres (as Spatraster)</p></dd>

<dt>tme</dt>
<dd><p>POSIXlt object of times corresponding to climate observations</p></dd>

<dt>windheight_m</dt>
<dd><p>Height of windspeed data in metres above ground (as numeric)</p></dd>

<dt>tempheight_m</dt>
<dd><p>Height of temperature data in metres above ground (as numeric)</p></dd>

<dt>temp</dt>
<dd><p>Temperature (deg C)</p></dd>

<dt>relhum</dt>
<dd><p>Relative humidity (Percentage)</p></dd>

<dt>pres</dt>
<dd><p>Sea-level atmospheric pressure (kPa)</p></dd>

<dt>swrad</dt>
<dd><p>Total downward shortwave radiation (W/m^2)</p></dd>

<dt>difrad</dt>
<dd><p>Downward diffuse radiation (W / m^2)</p></dd>

<dt>lwrad</dt>
<dd><p>Total downward longwave radiation (W/m^2)</p></dd>

<dt>windspeed</dt>
<dd><p>at 2m above ground (m/s)</p></dd>

<dt>winddir</dt>
<dd><p>Wind direction (decimal degrees)</p></dd>

<dt>prec</dt>
<dd><p>Precipitation (mm)</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>the model requires that input climate data are projected using a coordinate reference
system in which x and y are in metres. Since values returned by <code><a href="https://rdrr.io/pkg/mcera5/man/request_era5.html" class="external-link">mcera5::request_era5()</a></code>
are in lat long, the output data are reprojected using the coordinate reference system and
extent of dtm (but retain the approximate original grid resolution of the input climate data).
Returned climate data match the resolution, coordinate reference system and extent of <code>dtmc</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">ncfile</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/era5/era5_surface_ukeire_2018_05.nc'</span>,package<span class="op">=</span><span class="st">'mesoclim'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">aoi</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7.125</span>,<span class="op">-</span><span class="fl">2.875</span>,<span class="fl">49.375</span>,<span class="fl">51.625</span><span class="op">)</span>,crs<span class="op">=</span><span class="st">'EPSG:4326'</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dtm</span><span class="op">&lt;-</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/dtms/era5dtm.tif'</span>,package<span class="op">=</span><span class="st">'mesoclim'</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">era5input</span><span class="op">&lt;-</span><span class="fu">era5toclimarray</span><span class="op">(</span><span class="va">ncfile</span>, dtm<span class="op">=</span><span class="cn">NA</span>, aoi<span class="op">=</span><span class="va">aoi</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_q_layers.html">plot_q_layers</a></span><span class="op">(</span><span class="fu"><a href="dot-rast.html">.rast</a></span><span class="op">(</span><span class="va">era5input</span><span class="op">$</span><span class="va">temp</span>,<span class="va">era5input</span><span class="op">$</span><span class="va">dtm</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="era5toclimarray-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="checkinputs.html">checkinputs</a></span><span class="op">(</span><span class="va">era5input</span>,<span class="st">'hour'</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>No optional cloud cover variable found - continuing...</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>relative humidity values capped at 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Weather observations = 744"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Timesteps= 1 hrs, max= 1 hrs, min= 1 hrs"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Observations over 0.08 years, or 1 months, or 30.9583333333333 days."</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              Min.    Mean    Max.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> temp        1.960  13.120  30.690</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> relhum     30.130  80.027 100.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pres       97.573 101.526 102.979</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> swrad       0.000 237.733 906.987</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> difrad      0.000  86.262 416.216</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lwrad     238.508 318.355 404.901</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> windspeed   0.015   3.591  11.574</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> winddir     0.003 162.501 359.996</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> prec        0.000   0.065   5.813</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> elevation   0.000  25.294 195.494</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Plotting spatial variation by day of year: red=max, green=mean, blue=min"</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in datetime(plot_df$tstep):</span> could not find function "datetime"</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ilya Maclean, Alexandra Gardner, Jonathan Mosedale.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

